<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="UTF-8" />
    <title>DW Academy</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./공통css.css" />
  </head>
  <body>
    <div class="content-box students-page">
      <div id="global-menu" class="mneuu" data-src="menu.html"></div>
      <div class="container">
        <!-- 메인 -->
        <main class="main">
          <div class="content-box">
            <h2>학생 정보</h2>

            <!-- 검색 필터 + 탈퇴 버튼 -->
            <div class="filter-box">
              <label
                >소속:
                <select>
                  <option>- 전체 -</option>
                  <option>DW</option>
                  <option>JS</option>
                </select>
              </label>
              <label
                >검색:
                <select>
                  <option>- 전체 -</option>
                  <option>이름</option>
                  <option>아이디</option>
                </select>
                <input placeholder="검색어 입력" type="text" />
              </label>
              <button>검색</button>

              <div class="status-filter">
                상태:
                <label><input checked name="status" type="radio" /> 전체</label>
                <label><input name="status" type="radio" /> 정상</label>
                <label><input name="status" type="radio" /> 휴면</label>
                <label><input name="status" type="radio" /> 탈퇴</label>
              </div>

              <div style="margin-left: auto">
                <button class="btn-delete">🗑 선택 탈퇴</button>
              </div>
            </div>

            <!-- 학생 리스트 (Thymeleaf 적용) -->
            <table class="students-table">
              <thead>
                <tr>
                  <th><input id="checkAll" type="checkbox" /></th>
                  <th>No</th>
                  <th>아이디</th>
                  <th>이름</th>
                  <th>이메일</th>
                  <th>전화번호</th>
                  <th>가입일</th>
                  <th>상태</th>
                </tr>
              </thead>
              <tbody>
                <tr th:each="student, stat : ${students}">
                  <td>
                    <input
                      class="row-check"
                      th:value="${student.id}"
                      type="checkbox"
                    />
                  </td>
                  <td th:text="${stat.count}"></td>
                  <td>
                    <a
                      th:href="@{'/admin/students/' + ${student.id}}"
                      th:text="${student.username}"
                    ></a>
                  </td>
                  <td th:text="${student.name}"></td>
                  <td th:text="${student.email}"></td>
                  <td th:text="${student.phone}"></td>
                  <td
                    th:text="${#temporals.format(student.createdAt, 'yyyy-MM-dd')}"
                  ></td>
                  <td>
                    <span class="badge badge-green" th:if="${student.active}"
                      >정상</span
                    >
                    <span
                      class="badge badge-gray"
                      th:if="${student.status == 'SLEEP'}"
                      >휴면</span
                    >
                    <span class="badge badge-red" th:if="${!student.active}"
                      >탈퇴</span
                    >
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </main>
      </div>
    </div>

    <script>
      document.querySelectorAll(".submenu-toggle").forEach((btn) => {
        btn.addEventListener("click", () => {
          const submenu = btn.nextElementSibling;
          if (!submenu || !submenu.classList.contains("submenu")) return;

          const isOpen = submenu.classList.contains("open");
          if (isOpen) {
            submenu.style.height = submenu.scrollHeight + "px";
            submenu.classList.remove("open");
            requestAnimationFrame(() => (submenu.style.height = "0px"));
          } else {
            submenu.classList.add("open");
            submenu.style.height = submenu.scrollHeight + "px";
            submenu.addEventListener(
              "transitionend",
              () => {
                if (submenu.classList.contains("open")) {
                  submenu.style.height = "auto";
                }
              },
              { once: true }
            );
          }
        });
      });

      const blurSelectors = 'input[type="checkbox"], .btn-delete, a';
      document.addEventListener("pointerup", (e) => {
        if (e.target.matches(blurSelectors)) {
          setTimeout(() => e.target.blur(), 0);
        }
      });
      document.addEventListener("keyup", (e) => {
        if (
          (e.key === " " || e.key === "Enter") &&
          e.target.matches(blurSelectors)
        ) {
          e.target.blur();
        }
      });
    </script>
    <script src="menu-loader.js" defer></script>
  </body>
</html>
